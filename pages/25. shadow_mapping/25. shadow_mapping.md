## 25. Shadow Mapping

小学一年级，我们就了解了影子的知识。

![](../../imgs/shadow_map/shadow_map/shadow_front_back.jpg)

有个好朋友，天天跟我走，有时走在前，有时走在后，我和它说话，它却不开口。

“前、后”都是表示方位的词，这两个词既说明了影子和我形影不离的关系，也说明了影子的位置是不断变化的。

光线总是沿着直线的方向向前，当被某种不透明的物体挡住时，光线就没办法穿透而停止，这时这个物体的后面就会形成一片阴影，这样就产生了影子。

所以影子的形成需要两个条件：有光和被不透明的物体挡住。

### 1. 物理描述

当光线照射到一个物体上时，一部分光线被吸收，一部分光线被反射。如果有其他物体在光线的路径上，那么这些物体就会挡住一部分光线，从而在它们的背后产生阴影。

阴影的大小和形状取决于光源的位置、物体的形状和大小以及其他物体的位置和形状。

在现实生活中，阴影是由太阳、灯光等光源产生的，可以用于判断物体的位置和形状，以及场景的深度和逼真度。

下面是原神里开启、关闭阴影的对比，可以看到关闭阴影后，人物就像是浮在地面上，给人不真实的感觉。


### 2. 如何实现

在OpenGL中，渲染阴影的原理通常是使用阴影映射（Shadow Mapping）技术。

阴影映射是一种在3D计算机图形学中使用的技术。

通过从光源的透视图中渲染深度图，然后使用该深度图来确定场景的哪些部分处于阴影中，从而在场景中创建阴影。

深度图是从光源的透视图中渲染的，其中每个像素的值表示从光源到该像素的距离。

然后，深度图被投影到场景上，以确定哪些部分处于阴影中。

在渲染场景时，可以使用深度图来确定哪些部分应该被渲染为阴影。

这通常涉及到使用着色器来计算每个像素的深度值，并将其与深度图中的值进行比较，以确定该像素是否处于阴影中。

如果像素处于阴影中，则可以使用较暗的颜色进行渲染，以模拟阴影的效果。


